---
title: h264数据格式
date: 2020-03-30 20:20:06
tags:
    - h264
---

# 数据格式

## 前言

H264 中，句法元素从大到小被组织为序列(GOP)、图像、切片、宏块、子宏块共五个层次。

一个序列 = n 个图像帧
一个帧 = n 个切片
一个切片 = n 个宏块
一个宏块 = n 个子宏块  

## 码流结构

码流结构从功能上分为两层：
* VCL(视频编码层)
    包括核心压缩引擎和快，宏块和片的语法级别定义，设计目标是尽可能独立于网络进行高效的编码。即编码处理的输出，表示被压缩编码后的视频数据序列
* NAL(网络提取层)
    负责将VCL 产生的比特字符串适配到各种各样的网络和多元环境中，覆盖所有片级以上的语法级别

![media_format](.\pic\h264_data_format_\media_foramt.png)

## NALU HEADER

```txt

+---------------+
|0|1|2|3|4|5|6|7|
+-+-+-+-+-+-+-+-+
|F|NRI|   Type  |
+---------------+

```

NALU HEADER 数据位描述：
* F 在规范中一直为0
* NRI 表明这个NALU 的重要性
* Type 表明NALU 类型：
    *    1- 23 单个NAL 数据包
    *    其他的组包格式

## 几种常见的NALU 类型

主要介绍PPS、SPS和SEI:

* SPS(Sequence Parameter Sets，序列参数集):是H.264码流序列的第一个NALU。SPS 语法单元存放一个视频序列的共同特征。从SPS 中能获取图像的宽和高数据信息。如果SPS 丢失的话，解码大概率出现失败的情况。

* PPS(Picture Parameter Sets，图像参数集): 是H.264码流序列的第二个NALU。PPS 语法单元存放一个视频图像的典型特征。

* SEI(Supplemental Enhancement Information，补充增强信息):提供了向视频码流中加入额外信息的方法。